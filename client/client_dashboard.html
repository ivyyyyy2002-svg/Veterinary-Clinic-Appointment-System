<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>user_dashboard</title>
    <link rel="stylesheet" type="text/css" href="styles.css">
</head>

<body>

    <!-- Navigation bar -->
    <div class="navbar-dashboard">
        <ul>
            <li><a href="client_dashboard.html">Overview</a></li>
            <li><a href="client_profile.html">Profile</a></li>
            <li><a href="appointment.html">Book Appointments</a></li>
            <li><a href="#" id="logoutBtn">Sign Out</a></li>
        </ul>
    </div>

    <!-- title page -->
    <div class="title-client">
        <h1 id="welcomeTitle">Welcome, User</h1>
    </div>

    <div class="content">

        <!-- pet display section -->
        <div class="myPet">
            <h2>My Pets</h2>
            <button class="add-pet" onclick="window.location.href='register_pet.html'">Add a Pet</button>
            <div class="pet-container" id="petContainer">
                <!-- JS-generated pet cards -->
            </div>
        </div>

        <!-- appointments display section -->
        <div class="myAppointment">
            <h2>My Appointments</h2>
            <div class="appointment-container" id="appointmentContainer">
                <!-- future JS appointment data -->
            </div>
        </div>

    </div>

</body>


<script>
// login check
function checkLogin() {
    const ownerID = localStorage.getItem("ownerID");
    if (!ownerID) {
        alert("Please log in first.");
        window.location.href = "login.html";
    }
}

function loadUserName() {
    const name = localStorage.getItem("ownerName");
    const title = document.getElementById("welcomeTitle");
    if (name) title.textContent = `Welcome, ${name}`;
}

async function loadPets() {
    const ownerID = localStorage.getItem("ownerID");
    const petContainer = document.getElementById("petContainer");

    try {
        const res = await fetch(`http://localhost:5050/api/pets/owner/${ownerID}`);
        const pets = await res.json();

        if (!Array.isArray(pets) || pets.length === 0) {
            petContainer.innerHTML = "<p>No pets registered yet.</p>";
            return;
        }

        petContainer.innerHTML = "";
        pets.forEach(pet => {
            const petCard = document.createElement("div");
            petCard.className = "pet-card";

            petCard.innerHTML = `
                <h3>${pet.name}</h3>
                <div class="pet-info">
                    <div class="info-item"><span class="info-label">Species:</span> <span>${pet.type}</span></div>
                    <div class="info-item"><span class="info-label">Breed:</span> <span>${pet.breed}</span></div>
                    <div class="info-item"><span class="info-label">Color:</span> <span>${pet.color}</span></div>
                    <div class="info-item"><span class="info-label">Age:</span> <span>${pet.age}</span></div>
                    <div class="info-item"><span class="info-label">Gender:</span> <span>${pet.gender}</span></div>
                    <div class="info-item"><span class="info-label">Allergies:</span> <span>${pet.allergies}</span></div>
                </div>
            `;

            petContainer.appendChild(petCard);
        });
    } catch (err) {
        console.error("Error loading pets:", err);
        petContainer.innerHTML = "<p>Failed to load pets.</p>";
    }
}

// Load appointments
async function loadAppointments() {
    const ownerID = localStorage.getItem("ownerID");
    const container = document.getElementById("appointmentContainer");

    try {
        const res = await fetch(`http://localhost:5050/api/appointments/owner/${ownerID}`);
        const appointments = await res.json();

        if (!Array.isArray(appointments) || appointments.length === 0) {
            container.innerHTML = "<p>No appointments booked yet.</p>";
            return;
        }

        container.innerHTML = "";

        appointments.forEach(app => {
            const card = document.createElement("div");
            card.className = "appointment-card";

            card.innerHTML = `
                <h3>${app.pet_name} â€” ${app.disease_name || "General Checkup"}</h3>

                <div class="appointment-info">
                    <div class="info-item"><span class="info-label">Date:</span> <span>${app.appointmentDate}</span></div>
                    <div class="info-item"><span class="info-label">Time:</span> <span>${app.appointmentTime}</span></div>
                    <div class="info-item"><span class="info-label">Doctor:</span> <span>${app.staff_name || "N/A"}</span></div>
                    <div class="info-item"><span class="info-label">Status:</span> 
                        <span class="${app.status.toLowerCase()}">${app.status}</span>
                    </div>
                </div>
            `;

            container.appendChild(card);
        });

    } catch (err) {
        console.error("Error loading appointments:", err);
        container.innerHTML = "<p>Failed to load appointments.</p>";
    }
}

// Logout setup
function setupLogout() {
    const logoutBtn = document.getElementById("logoutBtn");
    logoutBtn.addEventListener("click", (event) => {
        event.preventDefault();
        localStorage.clear();
        alert("You have been signed out.");
        window.location.href = "home.html";
    });
}

document.addEventListener("DOMContentLoaded", () => {
    checkLogin();
    loadUserName();
    loadPets();
    loadAppointments();
    setupLogout();
});
</script>

</html>
