<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>appointment</title>
    <link rel="stylesheet" type="text/css" href="styles.css">
</head>
<body>
    <!-- Navigation bar -->
    <div class="navbar-dashboard">
        <ul>
            <li><a href="client_dashboard.html">Overview</a></li>
            <li><a href="client_profile.html">Profile</a></li>
            <li><a href="appointment.html">Book Appointments</a></li>
            <li><a href="#" id="logoutBtn">Sign Out</a></li>
        </ul>
    </div>

    <!-- appointment form (multi-step) -->
    <div class="content">
        <div class="appointment-form" id="appointment_form">
            <h2>Book an Appointment</h2>

            <form id="multiStepForm" novalidate>
            <!-- STEP 1 choose pets and service type -->
            <fieldset id="step1PetService" class="step active" data-step="1">
                <legend>Step 1 — Pet & Service</legend>

                <label for="petSelect">Select your pet</label>
                <select id="petSelect" name="pet" required>
                <option value="">-- Choose a pet --</option>
                <!-- JS will populate pet options here -->
                </select>

                <label for="serviceSelect">Service</label>
                <select id="serviceSelect" name="service" required>
                <option value="">-- Choose a service --</option>
                <option value="wellness">General Check-up</option>
                <option value="vaccination">Vaccination</option>
                <option value="illness">Illness Consultation</option>
                <option value="surgery">Surgery</option>
                <option value="dental">Dental Care</option>
                </select>

                <div class="step-actions">
                <button type="submit" class="btn btn-next">Next</button>
                </div>
                <output id="step1Result"></output>
            </fieldset>

            <!-- STEP 2 choose doctor and apoointment date -->
            <fieldset class="step" data-step="2">
                <legend>Step 2 — Vet, Date & Time</legend>

                <label for="vetSelect">Select veterinarian</label>
                <select id="vetSelect" name="vet" required>
                <option value="">-- Choose a veterinarian --</option>
                <option value="dr_ivy">Dr. Ivy Li</option>
                <option value="dr_ziqi">Dr. Ziqi Liu</option>
                <option value="dr_guest">Dr. Guest</option>
                </select>

                <label for="dateInput">Appointment date</label>
                <input id="dateInput" name="date" type="date" required>

                <label for="timeSelect">Time slot</label>
                <select id="timeSelect" name="time" required>
                <option value="">-- Choose a time --</option>
                
                <option value="09:00">09:00 AM</option>
                <option value="10:00">10:00 AM</option>
                <option value="11:00">11:00 AM</option>
                <option value="13:00">01:00 PM</option>
                <option value="14:00">02:00 PM</option>
                <option value="15:00">03:00 PM</option>
                </select>

                <div class="step-actions">
                <button type="button" class="btn btn-prev">Previous</button>
                <button type="button" class="btn btn-next">Next</button>
                </div>
            </fieldset>

            <!-- STEP 3 -->
            <fieldset class="step" data-step="3">
                <legend>Step 3 — Additional notes & Submit</legend>

                <label for="notes">Additional notes (medical history, restrictions, etc.)</label>
                <textarea id="notes" name="notes" rows="5" placeholder="Anything hospital should know..."></textarea>

                <div class="summary" id="appointmentSummary">
                <!-- JS will render a summary here before submit -->
                </div>

                <div class="step-actions">
                <button type="button" class="btn btn-prev">Previous</button>
                <button type="submit" class="btn btn-submit">Submit Appointment</button>
                </div>
            </fieldset>
            </form>
        </div>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const ownerID = localStorage.getItem("ownerID");
            if (!ownerID) {
                alert("Please log in before booking an appointment.");
                localStorage.setItem("postLoginRedirect", "appointment");
                window.location.href = "login.html";
            }
        });

        document.addEventListener("DOMContentLoaded", async () => {
            const ownerID = localStorage.getItem("ownerID");
            if (!ownerID) return;

            const petSelect = document.getElementById("petSelect");
            petSelect.innerHTML = `<option value="">-- Choose a pet --</option>`;

            try {
                const res = await fetch(`http://localhost:5050/api/pets/owner/${ownerID}`);
                const pets = await res.json();

                if (!Array.isArray(pets) || pets.length === 0) {
                    petSelect.innerHTML = `<option>No pets found. Register one first.</option>`;
                    return;
                }

                pets.forEach(pet => {
                    const option = document.createElement("option");
                    option.value = pet.petID;
                    option.textContent = `${pet.name} (${pet.type})`;
                    petSelect.appendChild(option);
                });

            } catch (err) {
                console.error("Failed to load pets:", err);
                petSelect.innerHTML = `<option>Error loading pets</option>`;
            }
        });
    </script>

    <script src="JS/signout.js"></script>


</body>
</html>